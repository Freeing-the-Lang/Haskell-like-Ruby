name: "ðŸ¤– Auto Update Contributors"

on:
  push:
    branches: [ main ]
  schedule:
    - cron: "0 0 * * 0"  # ë§¤ì£¼ ì¼ìš”ì¼ UTC 00:00 ìžë™ ì—…ë°ì´íŠ¸
  workflow_dispatch:

permissions:
  contents: write

jobs:
  update-contributors:
    runs-on: ubuntu-latest

    steps:
      - name: ðŸ“¦ Checkout
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: âš™ï¸ Install jq
        run: sudo apt-get update && sudo apt-get install -y jq

      - name: ðŸ§® Generate CONTRIBUTORS.md
        run: |
          echo "# ðŸ¤ Contributors" > CONTRIBUTORS.md
          echo "" >> CONTRIBUTORS.md
          echo "Automatically generated from GitHub API for [${{ github.repository }}](https://github.com/${{ github.repository }})." >> CONTRIBUTORS.md
          echo "" >> CONTRIBUTORS.md
          echo "| Avatar | Name | Contributions |" >> CONTRIBUTORS.md
          echo "|--------|------|----------------|" >> CONTRIBUTORS.md

          curl -s "https://api.github.com/repos/${{ github.repository }}/contributors?per_page=100" \
          | jq -r '.[] | select(.type=="User") | "| ![avatar](" + .avatar_url + "&s=40) | [" + .login + "](" + .html_url + ") | " + (.contributions|tostring) + " |"' \
          >> CONTRIBUTORS.md

          echo "" >> CONTRIBUTORS.md
          echo "_Last updated: $(date -u '+%Y-%m-%d %H:%M UTC')_" >> CONTRIBUTORS.md

      - name: ðŸ§± Commit and Push
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"
          git add CONTRIBUTORS.md
          if git diff --cached --quiet; then
            echo "âœ… No changes in contributor list."
          else
            git commit -m "ðŸ¤– Auto update CONTRIBUTORS.md"
            git push origin main
          fi
